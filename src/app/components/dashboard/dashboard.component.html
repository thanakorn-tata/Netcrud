<div class="p-6">
  <!-- Loading Spinner -->
  <div *ngIf="loading" class="flex justify-center items-center h-64">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <div *ngIf="!loading">
    <!-- Header -->
    <div class="mb-6 flex justify-between items-center">
      <div>
        <div class="text-2xl font-semibold text-gray-800">
          Student Internship Dashboard
        </div>
        <p class="mt-1 text-gray-600">
          ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
        </p>
      </div>
      <button
        (click)="refresh()"
        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
      >
        <i class="pi pi-refresh mr-2"></i>
        ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
      </button>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 gap-4 mb-6 md:grid-cols-2 xl:grid-cols-4">
      <!-- Total Interns Card -->
      <div
        class="p-6 transition-shadow bg-white border-l-4 border-purple-600 rounded-lg shadow-sm hover:shadow-md"
      >
        <div class="flex items-center justify-between gap-4">
          <div class="flex flex-col w-full gap-1">
            <div class="flex items-center justify-between w-full gap-2">
              <div class="p-3 bg-purple-100 rounded-lg">
                <i class="pi pi-users text-purple-600 !text-3xl"></i>
              </div>
              <span class="text-3xl font-bold text-gray-800">{{
                totalInterns
              }}</span>
            </div>
            <span class="text-sm font-medium text-right text-gray-600"
              >‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span
            >
          </div>
        </div>
      </div>

      <!-- Universities Card -->
      <div
        class="p-6 transition-shadow bg-white border-l-4 border-indigo-600 rounded-lg shadow-sm hover:shadow-md"
      >
        <div class="flex items-center justify-between gap-4">
          <div class="flex flex-col w-full gap-1">
            <div class="flex items-center justify-between w-full gap-2">
              <div class="p-3 bg-indigo-100 rounded-lg">
                <i class="pi pi-building text-indigo-600 !text-3xl"></i>
              </div>
              <span class="text-3xl font-bold text-gray-800">{{
                totalUniversities
              }}</span>
            </div>
            <span class="text-sm font-medium text-right text-gray-600"
              >‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</span
            >
          </div>
        </div>
      </div>

      <!-- Departments Card -->
      <div
        class="p-6 transition-shadow bg-white border-l-4 rounded-lg shadow-sm hover:shadow-md border-violet-600"
      >
        <div class="flex items-center justify-between gap-4">
          <div class="flex flex-col w-full gap-1">
            <div class="flex items-center justify-between w-full gap-2">
              <div class="p-3 rounded-lg bg-violet-100">
                <i class="pi pi-briefcase text-violet-600 !text-3xl"></i>
              </div>
              <span class="text-3xl font-bold text-gray-800">{{
                totalDepartments
              }}</span>
            </div>
            <span class="text-sm font-medium text-right text-gray-600"
              >‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö</span
            >
          </div>
        </div>
      </div>

      <!-- Average Grade Card -->
      <div
        class="p-6 transition-shadow bg-white border-l-4 border-pink-600 rounded-lg shadow-sm hover:shadow-md"
      >
        <div class="flex items-center justify-between gap-4">
          <div class="flex flex-col w-full gap-1">
            <div class="flex items-center justify-between w-full gap-2">
              <div class="p-3 bg-pink-100 rounded-lg">
                <i class="pi pi-chart-line text-pink-600 !text-3xl"></i>
              </div>
              <span class="text-3xl font-bold text-gray-800">{{
                averageGrade
              }}</span>
            </div>
            <span class="text-sm font-medium text-right text-gray-600"
              >‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Main Charts Row -->
    <div class="grid grid-cols-1 gap-6 mb-6 xl:grid-cols-3">
      <!-- Top 10 Universities Chart -->
      <div
        class="p-6 bg-white border border-gray-200 rounded-lg shadow-lg xl:col-span-2 card"
      >
        <div class="mb-4 text-xl font-semibold">Top 10 ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</div>
        <p-chart
          type="bar"
          [data]="universityChartData"
          [options]="universityChartOptions"
          height="400px"
        ></p-chart>
      </div>

      <!-- Department Distribution -->
      <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-lg card">
        <div class="mb-4 text-xl font-semibold">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</div>
        <p-chart
          type="pie"
          [data]="departmentChartData"
          [options]="departmentChartOptions"
          height="400px"
        ></p-chart>
      </div>
    </div>

    <!-- Grade Distribution and Duration Charts -->
    <div class="grid grid-cols-1 gap-6 mb-6 xl:grid-cols-2">
      <!-- Grade Distribution Chart -->
      <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-lg card">
        <div class="mb-4 text-xl font-semibold">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏£‡∏î</div>
        <p-chart
          type="bar"
          [data]="gradeDistributionData"
          [options]="gradeDistributionOptions"
          height="300px"
        ></p-chart>
      </div>

      <!-- Duration Chart -->
      <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-lg card">
        <div class="mb-4 text-xl font-semibold">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</div>
        <p-chart
          type="doughnut"
          [data]="durationChartData"
          [options]="durationChartOptions"
          height="300px"
        ></p-chart>
      </div>
    </div>

    <!-- Top 10 Students Table -->
    <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-lg card">
      <div class="mb-4 flex justify-between items-center">
        <div class="text-xl font-semibold">üèÜ Top 10 ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡∏£‡∏î‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
        <span class="text-sm text-gray-600">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏£‡∏î A ‚Üí F</span>
      </div>

      <p-table
        [value]="topStudents"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-striped"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="text-center" style="width: 8%">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
            <th style="width: 25%">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th style="width: 30%">‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</th>
            <th style="width: 22%">‡∏ù‡πà‡∏≤‡∏¢‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</th>
            <th class="text-center" style="width: 15%">‡πÄ‡∏Å‡∏£‡∏î</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-student>
          <tr>
            <td class="text-center">
              <span
                [class]="student.rank <= 3 ? 'inline-flex items-center justify-center w-10 h-10 font-bold text-white rounded-full' : 'inline-flex items-center justify-center w-10 h-10 font-semibold text-purple-800 bg-purple-100 rounded-full'"
                [style.background]="student.rank === 1 ? '#FFD700' : student.rank === 2 ? '#C0C0C0' : student.rank === 3 ? '#CD7F32' : ''"
              >
                <span *ngIf="student.rank === 1">ü•á</span>
                <span *ngIf="student.rank === 2">ü•à</span>
                <span *ngIf="student.rank === 3">ü•â</span>
                <span *ngIf="student.rank > 3">{{ student.rank }}</span>
              </span>
            </td>
            <td>
              <span class="font-medium">{{ student.fullname }}</span>
            </td>
            <td>
              <span class="text-gray-700">{{ student.university }}</span>
            </td>
            <td>
              <span class="text-sm text-gray-600">{{ student.department }}</span>
            </td>
            <td class="text-center">
              <span
                [class]="'inline-flex items-center px-3 py-1 font-bold rounded-full ' + getGradeBadgeClass(student.grade)"
              >
                {{ student.grade }}
              </span>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center py-6 text-gray-500">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏£‡∏î
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>
