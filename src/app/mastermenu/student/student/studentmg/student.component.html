<div class="container max-w-full p-4">
  <div class="p-4 text-blue-900 rounded-lg">
    <!-- Accordion -->
    <div class="mb-4">
      <p-accordion [activeIndex]="0" styleClass="mb-5">
        <p-accordionTab
          [header]="'student.search.header' | translate"
          [headerStyle]="{
            'background-color': '#8b5cf6',
            color: '#ffffff',
            'font-weight': '600'
          }"
          [contentStyle]="{ 'background-color': '#ede9fe', color: '#5d3b80' }"
        >
          <!-- ฟอร์มค้นหา -->
          <div class="grid gap-4 text-white lg:grid-cols-4 md:grid-cols-2 sm:grid-cols-1">
            <!-- Full Name -->
            <div>
              <label class="block mb-2 font-semibold text-blue-900">
                {{ 'student.fullname' | translate }}
              </label>
              <input
                type="text"
                [(ngModel)]="searchFilters.fullname"
                class="w-full p-2 text-black border border-blue-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="{{ 'common.message.Pleaseenter' | translate }}"
              />
            </div>

            <!-- University -->
            <div>
              <label class="block mb-2 font-semibold text-blue-900">
                {{ 'student.university' | translate }}
              </label>
              <input
                type="text"
                [(ngModel)]="searchFilters.university"
                class="w-full p-2 text-black border border-blue-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="{{ 'common.message.Pleaseenter' | translate }}"
              />
            </div>

            <!-- Faculty -->
            <div>
              <label class="block mb-2 font-semibold text-blue-900">
                {{ 'student.faculty' | translate }}
              </label>
              <input
                type="text"
                [(ngModel)]="searchFilters.faculty"
                class="w-full p-2 text-black border border-blue-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="{{ 'common.message.Pleaseenter' | translate }}"
              />
            </div>

            <!-- Major -->
            <div>
              <label class="block mb-2 font-semibold text-blue-900">
                {{ 'student.major' | translate }}
              </label>
              <input
                type="text"
                [(ngModel)]="searchFilters.major"
                class="w-full p-2 text-black border border-blue-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="{{ 'common.message.Pleaseenter' | translate }}"
              />
            </div>
          </div>

          <!-- Buttons -->
          <div class="flex justify-center gap-2 mt-6">
  <!-- ปุ่ม Search -->
  <p-button
    [label]="'common.button.search' | translate"
    icon="pi pi-search"
    (onClick)="onSearch()"
    styleClass="p-button-sm bg-purple-500 border-purple-500 text-white hover:bg-purple-600"
  ></p-button>

  <!-- ปุ่ม Clear -->
  <p-button
    [label]="'common.button.clear' | translate"
    icon="pi pi-refresh"
    variant="outlined"
    (onClick)="onClear()"
    styleClass="p-button-sm border-purple-500 text-purple-500 hover:bg-purple-100"
  ></p-button>
</div>
        </p-accordionTab>
      </p-accordion>
    </div>

    <!-- Header + Add button -->
    <div class="flex items-center justify-between my-4">
      <h4 class="font-semibold text-blue-900">
        {{ 'student.list.header' | translate }}
        <span *ngIf="!isAdmin" class="text-sm text-gray-600 ml-2">
          ({{ 'student.list.userinfo' | translate }})
        </span>
      </h4>
      <p-button
        [label]="'common.button.add' | translate"
        icon="pi pi-plus-circle"
        (onClick)="openPage()"
        styleClass="p-button-sm bg-blue-500 border-blue-500 text-white hover:bg-blue-600"
      ></p-button>
    </div>
    <hr class="border-blue-400" />

    <!-- Table -->
    <p-table
      stripedRows
      [value]="filteredStudents"
      [totalRecords]="totalRecords"
      [paginator]="true"
      [rowHover]="true"
      [rows]="rows"
      styleClass="p-datatable-striped"
      [tableStyle]="{ 'min-width': '80rem' }"
    >
      <!-- Header -->
      <ng-template pTemplate="header">
        <tr>
          <th class="text-center" style="width: 5%">{{ 'common.table.no' | translate }}</th>
          <th style="width: 12%">{{ 'student.fullname' | translate }}</th>
          <th style="width: 10%">{{ 'student.university' | translate }}</th>
          <th style="width: 10%">{{ 'student.faculty' | translate }}</th>
          <th style="width: 10%">{{ 'student.major' | translate }}</th>
          <th style="width: 8%">{{ 'student.contact_number' | translate }}</th>
          <th style="width: 10%">{{ 'student.email' | translate }}</th>
          <th style="width: 10%">{{ 'student.intern_department' | translate }}</th>
          <th style="width: 10%">{{ 'student.intern_duration' | translate }}</th>
          <th class="text-center" style="width: 8%">Grade</th>
          <th class="text-center" style="width: 10%">{{ 'common.table.manage' | translate }}</th>
        </tr>
      </ng-template>

      <!-- Body -->
      <ng-template pTemplate="body" let-student let-rowIndex="rowIndex">
        <tr>
          <td class="text-center text-black">{{ rowIndex + 1 }}</td>
          <td>{{ student.fullname }}</td>
          <td>{{ student.university }}</td>
          <td>{{ student.faculty }}</td>
          <td>{{ student.major }}</td>
          <td>{{ student.contact_number }}</td>
          <td>{{ student.email }}</td>
          <td>{{ student.intern_department }}</td>
          <td>{{ student.intern_duration }}</td>
          <td class="text-center">
            <p-select
              *ngIf="isAdmin"
              [(ngModel)]="student.grade"
              [options]="gradeOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="{{ 'student.grade.placeholder' | translate }}"
              (onChange)="onGradeChange(student)"
              styleClass="w-full"
              appendTo="body"
            ></p-select>

            <span *ngIf="!isAdmin" class="font-semibold" [class]="getGradeColor(student.grade)">
              {{ student.grade || '-' }}
            </span>
          </td>
          <td class="text-center">
            <!-- Admin actions -->
            <span *ngIf="isAdmin" class="pi pi-pencil text-blue-600 cursor-pointer" (click)="openPage(student.id)" title="{{ 'common.button.edit' | translate }}"></span>
            <span *ngIf="isAdmin" class="pi pi-trash text-red-600 cursor-pointer ml-2" (click)="deleteStudent(student.id)" title="{{ 'common.button.delete' | translate }}"></span>

            <!-- User actions -->
            <span *ngIf="!isAdmin && isMyStudent(student)" class="pi pi-pencil text-blue-600 cursor-pointer" (click)="openPage(student.id)" title="{{ 'common.button.edit' | translate }}"></span>
            <span *ngIf="!isAdmin && isMyStudent(student)" class="pi pi-trash text-red-600 cursor-pointer ml-2" (click)="deleteStudent(student.id)" title="{{ 'common.button.delete' | translate }}"></span>
            <span *ngIf="!isAdmin && !isMyStudent(student)" class="pi pi-eye text-gray-600 cursor-pointer" (click)="viewStudent(student.id)" title="{{ 'common.button.view' | translate }}"></span>
          </td>
        </tr>
      </ng-template>

      <!-- Empty message -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="11" class="text-center py-6 text-gray-500">
            {{ 'common.table.emptyMessage' | translate }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Delete Confirmation Dialog -->
<p-dialog [(visible)]="showDeleteDialog" [modal]="true" [style]="{width: '450px'}" header="{{ 'common.dialog.deleteHeader' | translate }}">
  <div class="flex items-center gap-3">
    <i class="pi pi-exclamation-triangle text-red-500 text-4xl"></i>
    <span>{{ 'common.dialog.deleteMessage' | translate:{name:selectedStudent?.fullname} }}</span>
  </div>
  <ng-template pTemplate="footer">
    <p-button label="{{ 'common.button.cancel' | translate }}" icon="pi pi-times" (onClick)="showDeleteDialog = false" styleClass="p-button-text"></p-button>
    <p-button label="{{ 'common.button.delete' | translate }}" icon="pi pi-trash" (onClick)="confirmDelete()" styleClass="p-button-danger"></p-button>
  </ng-template>
</p-dialog>
